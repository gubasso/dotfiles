# kitty terminal
# ~/.config/kitty/kitty.conf
# kitty_mod ctrl+shift (default)

# ================================================================
# Global
# ================================================================
shell /usr/bin/fish

# Reload config
map ctrl+shift+r load_config_file

# Using remote_control in a few maps
allow_remote_control yes

# ================================================================
# History / Scrollback tooling
# ================================================================

# # ENTIRE SCROLLBACK
# LESS (navigate in terminal):
# Open the entire scrollback buffer in an overlay using less,
# positioned at the very end of the history. Preserves ANSI colors.
map kitty_mod+e launch --stdin-source=@screen_scrollback --stdin-add-formatting --type=overlay less +G -R

# In neovim:
# Open the entire scrollback buffer in an overlay Neovim session,
# with the cursor placed at the bottom of the buffer.
map ctrl+space>e launch --stdin-source=@screen_scrollback --type=overlay nvim -

# Copy to clipboard:
# Takes the entire scrollback -> copies stdin to the system clipboard
map ctrl+space>shift+y launch --stdin-source=@screen_scrollback kitten clipboard


# # LAST COMMAND
# LESS (navigate in terminal):
# Pager (overlay): command + output (with colors)
map kitty_mod+g launch --type=overlay --stdin-source=@last_cmd_output --stdin-add-formatting sh -lc '~/.local/bin/cat-lastcmd | less +G -R'

# In neovim:
# Neovim (overlay): command + output (plain text)
map ctrl+space>g launch --type=overlay --stdin-source=@last_cmd_output sh -lc '~/.local/bin/cat-lastcmd | nvim - -c "normal! G"'

# Copy to clipboard:
# Copy: "❯ <last command>" + its output (plain text) to system clipboard
map ctrl+space>y launch --stdin-source=@last_cmd_output sh -c '~/.local/bin/cat-lastcmd | kitten clipboard'


# ================================================================
# Layouts / "Zoom"
# ================================================================

# Keep only the layouts you actually use
enabled_layouts splits:split_axis=horizontal,stack

# IMPORTANT: replace builtin toggle_layout with a kitten that forces relayout.
# This prevents the "active border disappears after zoom-out" state.
map ctrl+space>z kitten zoom_toggle_borders.py


# ================================================================
# Window focus / navigation / resize
# ================================================================

map ctrl+shift+h neighboring_window left
map ctrl+shift+j neighboring_window down
map ctrl+shift+k neighboring_window up
map ctrl+shift+l neighboring_window right

map alt+shift+h resize_window wider 5
map alt+shift+j resize_window shorter 5
map alt+shift+k resize_window taller 5
map alt+shift+l resize_window narrower 5
map alt+shift+equal reset_window_sizes


# ================================================================
# Splits creation + fine resizing
# ================================================================

# Create splits
map ctrl+space>minus     launch --cwd=current --location=hsplit
map ctrl+space>backslash launch --cwd=current --location=vsplit

# Fine resize via remote control
map alt+h remote_control resize-window -i 2  -a horizontal
map alt+l remote_control resize-window -i -2 -a horizontal
map alt+j remote_control resize-window -i 2  -a vertical
map alt+k remote_control resize-window -i -2 -a vertical


# ================================================================
# Tabs
# ================================================================

# Tab "move mode"
map --new-mode tabmove ctrl+space>m
map --mode tabmove esc pop_keyboard_mode
map --mode tabmove m   pop_keyboard_mode

map --mode tabmove h     move_tab_backward
map --mode tabmove left  move_tab_backward
map --mode tabmove l     move_tab_forward
map --mode tabmove right move_tab_forward

map ctrl+space>, set_tab_title
map ctrl+space>t new_tab_with_cwd
map ctrl+space>shift+t new_tab
map ctrl+space>w close_tab
map ctrl+space>alt+. move_tab_forward
map ctrl+space>alt+, move_tab_backward
map ctrl+space>s select_tab

map ctrl+tab goto_tab -1
map ctrl+space>n next_tab
map ctrl+space>p previous_tab

map ctrl+1 goto_tab 1
map ctrl+2 goto_tab 2
map ctrl+3 goto_tab 3
map ctrl+4 goto_tab 4
map ctrl+5 goto_tab 5
map ctrl+6 goto_tab 6
map ctrl+7 goto_tab 7
map ctrl+8 goto_tab 8
map ctrl+9 goto_tab 9
map ctrl+0 goto_tab 10


# ================================================================
# UI / Theme / Fonts
# ================================================================

font_family Hack
font_size 17.0

tab_bar_style separator
tab_bar_min_tabs 1
tab_separator " ┇"

# Optional (recommended): always show the current layout name in the tab title.
# This gives you a second "zoom" cue even if you miss the border change.
# (layout_name is a supported variable for tab_title_template)
tab_title_template "{index}:{title}{' ⣿' if layout_name == 'stack' and num_windows > 1 else ''}"

# Theme includes
# include theme-everforest-dark-hard.conf
include ~/.local/state/kitty/active-theme.conf


# ================================================================
# Borders / Visual cues (KEEP THIS AFTER THE THEME INCLUDES)
# ================================================================

# 1) Always draw a border when only one window is visible (focus cue).
#    kitty draws full borders around the single visible window when enabled.
draw_window_borders_for_single_window yes

# 2) Ensure a stable "active split has a full rectangle border" cue without
#    doubled internal borders:
#    - draw_minimal_borders can stay yes (compact)
#    - a non-zero window_margin_width overrides minimal borders and makes kitty draw
#      full borders around each window, with a small gap (clean, no doubled line).
draw_minimal_borders yes
window_margin_width 2
single_window_margin_width 0

# Border thickness
window_border_width 1 pt
