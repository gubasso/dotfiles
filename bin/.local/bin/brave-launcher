#!/usr/bin/bash
set -euo pipefail

XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
USER_FLAGS_FILE="$XDG_CONFIG_HOME/brave-flags.conf"

collect_flags () {
  local file=$1
  [[ -f $file ]] || return
  # shellcheck disable=SC2207
  mapfile -t lines < <(grep -vE '^\s*($|#)' "$file")
  echo "${lines[*]}"
}

USER_FLAGS=$(collect_flags "$USER_FLAGS_FILE")

BRAVE_BIN="/usr/bin/brave"
exec "$BRAVE_BIN" $USER_FLAGS "$@"
